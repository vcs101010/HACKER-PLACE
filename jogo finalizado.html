<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hacker Place</title>
  <style>
    /* Reset simples */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height: 100%; background: #0b0b0b; color: #dbeafe; font-family: monospace; }
    .center { display:flex; align-items:center; justify-content:center; }
    .container {
      min-height:100vh;
      padding:24px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      background:linear-gradient(180deg,#04060a 0%, #0b0b0b 100%);
    }
    h1 { font-size:36px; color:#38d48a; letter-spacing:1px; }
    p.lead { color:#4dd0e1; font-size:13px; }
    .canvas-wrap { position:relative; }
    canvas {
      border:4px solid #16a34a;
      border-radius:10px;
      box-shadow:0 20px 50px rgba(0,0,0,0.7);
      display:block;
      background:#000;
    }
    /* overlay "Voc√™ venceu" */
    .overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.8);
      border-radius:10px;
      color:#38d48a;
      text-align:center;
      gap:12px;
      padding:20px;
      display:none;
    }
    .overlay.show { display:flex; }
    .btn {
      padding:10px 18px;
      background:#16a34a;
      color:#000;
      font-weight:700;
      border-radius:8px;
      cursor:pointer;
      border:none;
    }
    .hud-legend { color:#16a34a; font-size:12px; margin-top:8px; text-align:left; }
    .hud-legend p { margin:4px 0; color:#9ff3d1; font-size:12px; }
    /* small screens */
    @media (max-width:840px){
      canvas { width:100%; height:auto; max-width:800px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="text-align:center;">
      <h1>HACKER PLACE</h1>
      <p class="lead">WASD = Mover | N = Ativar Hack | Objetivo: Alcan√ßar o c√≥digo fonte</p>
    </div>

    <div class="canvas-wrap">
      <canvas id="gameCanvas" width="800" height="500"></canvas>

      <div id="winOverlay" class="overlay">
        <div>
          <h2 style="font-size:42px; color:#38d48a; margin-bottom:8px;">VOC√ä VENCEU!</h2>
          <p style="color:#7fe7d0; font-size:18px; margin-bottom:14px;">Todas as fases conclu√≠das!</p>
          <button id="restartBtn" class="btn">JOGAR NOVAMENTE</button>
        </div>
      </div>
    </div>

    <div class="hud-legend">
      <p>üíÄ Vermelho = Inimigos (evite!)</p>
      <p>üü¢ Verde = Plataformas vis√≠veis</p>
      <p>üîµ Ciano = Plataformas hackeadas (pressione N)</p>
      <p>‚≠ê Amarelo = C√≥digo fonte (objetivo)</p>
    </div>
  </div>

  <script>
  (() => {
    // --- Estado do jogo (substitui useRef/useState do React) ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const winOverlay = document.getElementById('winOverlay');
    const restartBtn = document.getElementById('restartBtn');

    let gameState = 'playing'; // 'playing' | 'won'
    let level = 1;

    const game = {
      player: { x:50, y:400, width:30, height:30, velocityY:0, isJumping:false },
      keys: {},
      platforms: [],
      hiddenPlatforms: [],
      enemies: [],
      goal: { x:0, y:0, width:40, height:40 },
      gravity: 0.6,
      hackActive: false,
      canHack: true,
      hackCooldown: 0
    };

    function initLevel(levelNum) {
      game.player = { x:50, y:400, width:30, height:30, velocityY:0, isJumping:false };
      game.hackActive = false;
      game.canHack = true;
      game.hackCooldown = 0;

      if (levelNum === 1) {
        game.platforms = [
          { x: 0, y: 450, width: 250, height: 25 },
          { x: 350, y: 380, width: 200, height: 25 },
          { x: 650, y: 310, width: 150, height: 25 }
        ];
        game.hiddenPlatforms = [
          { x: 250, y: 420, width: 120, height: 25 },
          { x: 550, y: 350, width: 120, height: 25 }
        ];
        game.enemies = [
          { x: 380, y: 350, width: 28, height: 28, speed: 1.5, direction: 1, range: 120, startX: 380 }
        ];
        game.goal = { x: 745, y: 255, width: 45, height: 45 };
      } else if (levelNum === 2) {
        game.platforms = [
          { x: 0, y: 450, width: 150, height: 25 },
          { x: 100, y: 380, width: 100, height: 25 },
          { x: 250, y: 310, width: 100, height: 25 },
          { x: 400, y: 380, width: 100, height: 25 },
          { x: 550, y: 310, width: 100, height: 25 },
          { x: 680, y: 240, width: 120, height: 25 }
        ];
        game.hiddenPlatforms = [
          { x: 0, y: 350, width: 80, height: 25 },
          { x: 200, y: 345, width: 80, height: 25 },
          { x: 350, y: 275, width: 80, height: 25 },
          { x: 500, y: 345, width: 80, height: 25 }
        ];
        game.enemies = [
          { x: 110, y: 350, width: 28, height: 28, speed: 2, direction: 1, range: 80, startX: 110 },
          { x: 260, y: 280, width: 28, height: 28, speed: 2.2, direction: 1, range: 85, startX: 260 },
          { x: 410, y: 350, width: 28, height: 28, speed: 1.8, direction: 1, range: 75, startX: 410 }
        ];
        game.goal = { x: 740, y: 180, width: 45, height: 45 };
      } else if (levelNum === 3) {
        game.platforms = [
          { x: 0, y: 450, width: 100, height: 25 },
          { x: 150, y: 400, width: 80, height: 25 },
          { x: 280, y: 350, width: 70, height: 25 },
          { x: 400, y: 300, width: 70, height: 25 },
          { x: 520, y: 250, width: 70, height: 25 },
          { x: 640, y: 200, width: 80, height: 25 },
          { x: 350, y: 420, width: 90, height: 25 },
          { x: 500, y: 380, width: 80, height: 25 }
        ];
        game.hiddenPlatforms = [
          { x: 100, y: 425, width: 70, height: 25 },
          { x: 230, y: 375, width: 70, height: 25 },
          { x: 350, y: 325, width: 70, height: 25 },
          { x: 470, y: 275, width: 70, height: 25 },
          { x: 590, y: 225, width: 70, height: 25 },
          { x: 440, y: 405, width: 80, height: 25 }
        ];
        game.enemies = [
          { x: 160, y: 370, width: 28, height: 28, speed: 2.5, direction: 1, range: 65, startX: 160 },
          { x: 290, y: 320, width: 28, height: 28, speed: 2.8, direction: 1, range: 60, startX: 290 },
          { x: 410, y: 270, width: 28, height: 28, speed: 3, direction: 1, range: 65, startX: 410 },
          { x: 530, y: 220, width: 28, height: 28, speed: 2.6, direction: 1, range: 60, startX: 530 },
          { x: 360, y: 390, width: 28, height: 28, speed: 2.2, direction: 1, range: 70, startX: 360 }
        ];
        game.goal = { x: 745, y: 140, width: 45, height: 45 };
      }
    }

    // --- Input ---
    window.addEventListener('keydown', (e) => {
      game.keys[e.key.toLowerCase()] = true;
      if (e.key.toLowerCase() === 'n' && game.canHack) {
        game.hackActive = !game.hackActive;
        game.canHack = false;
        game.hackCooldown = 60;
      }
    });
    window.addEventListener('keyup', (e) => {
      game.keys[e.key.toLowerCase()] = false;
    });

    // --- Utility collision check ---
    function checkCollision(rect1, rect2) {
      return rect1.x < rect2.x + rect2.width &&
             rect1.x + rect1.width > rect2.x &&
             rect1.y < rect2.y + rect2.height &&
             rect1.y + rect1.height > rect2.y;
    }

    // --- Game loop ---
    let animationId = null;
    function gameLoop() {
      const now = Date.now();

      // Background gradient by level
      const bgGradient = ctx.createLinearGradient(0,0,0,canvas.height);
      if (level === 1) {
        bgGradient.addColorStop(0,'#0a0e27');
        bgGradient.addColorStop(1,'#1a1f3a');
      } else if (level === 2) {
        bgGradient.addColorStop(0,'#1a0a27');
        bgGradient.addColorStop(1,'#2a1a3a');
      } else {
        bgGradient.addColorStop(0,'#270a0a');
        bgGradient.addColorStop(1,'#3a1a1a');
      }
      ctx.fillStyle = bgGradient;
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // Animated grid
      ctx.strokeStyle = level === 1 ? '#1a2332' : level === 2 ? '#2a1a32' : '#321a1a';
      ctx.lineWidth = 1;
      const offset = (now / 50) % 40;
      for (let i = -40; i < canvas.width; i += 40) {
        ctx.beginPath();
        ctx.moveTo(i + offset, 0);
        ctx.lineTo(i + offset, canvas.height);
        ctx.stroke();
      }
      for (let i = -40; i < canvas.height; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i + offset);
        ctx.lineTo(canvas.width, i + offset);
        ctx.stroke();
      }

      // Cooldown handling
      if (game.hackCooldown > 0) {
        game.hackCooldown--;
        if (game.hackCooldown === 0) game.canHack = true;
      }

      // Movement
      if (game.keys['a']) game.player.x -= 4;
      if (game.keys['d']) game.player.x += 4;
      if (game.keys['w'] && !game.player.isJumping) {
        game.player.velocityY = -12;
        game.player.isJumping = true;
      }

      // Gravity
      game.player.velocityY += game.gravity;
      game.player.y += game.player.velocityY;

      // Platforms collision (include hidden if hack active)
      const allPlatforms = [...game.platforms];
      if (game.hackActive) allPlatforms.push(...game.hiddenPlatforms);

      game.player.isJumping = true;
      allPlatforms.forEach(platform => {
        if (game.player.velocityY > 0 &&
            game.player.x < platform.x + platform.width &&
            game.player.x + game.player.width > platform.x &&
            game.player.y + game.player.height > platform.y &&
            game.player.y + game.player.height < platform.y + platform.height) {
          game.player.y = platform.y - game.player.height;
          game.player.velocityY = 0;
          game.player.isJumping = false;
        }
      });

      // Boundaries
      if (game.player.x < 0) game.player.x = 0;
      if (game.player.x + game.player.width > canvas.width) {
        game.player.x = canvas.width - game.player.width;
      }
      if (game.player.y > canvas.height) {
        // fell -> restart level
        initLevel(level);
      }

      // Enemies update + collisions
      game.enemies.forEach(enemy => {
        enemy.x += enemy.speed * enemy.direction;
        if (enemy.x > enemy.startX + enemy.range || enemy.x < enemy.startX) {
          enemy.direction *= -1;
        }
        if (checkCollision(game.player, enemy)) {
          initLevel(level);
        }
      });

      // Goal collision
      if (checkCollision(game.player, game.goal)) {
        if (level < 3) {
          level++;
          initLevel(level);
        } else {
          gameState = 'won';
          showWin();
        }
      }

      // --- Drawing ---

      // Platforms (visible)
      game.platforms.forEach(platform => {
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#00ff88';
        const platGradient = ctx.createLinearGradient(platform.x, platform.y, platform.x, platform.y + platform.height);
        platGradient.addColorStop(0, '#00ff88');
        platGradient.addColorStop(1, '#00cc66');
        ctx.fillStyle = platGradient;
        ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

        ctx.strokeStyle = '#00ffaa';
        ctx.lineWidth = 3;
        ctx.strokeRect(platform.x, platform.y, platform.width, platform.height);

        ctx.strokeStyle = '#00ffcc';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(platform.x + 5, platform.y + platform.height / 2);
        ctx.lineTo(platform.x + platform.width - 5, platform.y + platform.height / 2);
        ctx.stroke();

        ctx.shadowBlur = 0;
      });

      // Hidden platforms
      if (game.hackActive) {
        game.hiddenPlatforms.forEach(platform => {
          ctx.shadowBlur = 20 + Math.sin(now / 200) * 5;
          ctx.shadowColor = '#00ffff';
          const hackGradient = ctx.createLinearGradient(platform.x, platform.y, platform.x, platform.y + platform.height);
          hackGradient.addColorStop(0, '#00ffff');
          hackGradient.addColorStop(1, '#00cccc');
          ctx.fillStyle = hackGradient;
          ctx.globalAlpha = 0.9;
          ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

          ctx.strokeStyle = '#00ffff';
          ctx.lineWidth = 3;
          ctx.strokeRect(platform.x, platform.y, platform.width, platform.height);

          ctx.fillStyle = '#ffffff';
          ctx.globalAlpha = 0.3;
          for (let i = 0; i < platform.width; i += 10) {
            ctx.fillRect(platform.x + i, platform.y + 2, 2, platform.height - 4);
          }

          ctx.globalAlpha = 1;
          ctx.shadowBlur = 0;
        });
      } else {
        game.hiddenPlatforms.forEach(platform => {
          ctx.fillStyle = '#1a2332';
          ctx.globalAlpha = 0.25;
          ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
          ctx.strokeStyle = '#2a3342';
          ctx.lineWidth = 1;
          ctx.setLineDash([5,5]);
          ctx.strokeRect(platform.x, platform.y, platform.width, platform.height);
          ctx.setLineDash([]);
          ctx.globalAlpha = 1;
        });
      }

      // Enemies
      game.enemies.forEach(enemy => {
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#ff0055';
        const enemyGradient = ctx.createRadialGradient(
          enemy.x + enemy.width/2, enemy.y + enemy.height/2, 0,
          enemy.x + enemy.width/2, enemy.y + enemy.height/2, enemy.width/2
        );
        enemyGradient.addColorStop(0,'#ff0055');
        enemyGradient.addColorStop(1,'#cc0033');
        ctx.fillStyle = enemyGradient;
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);

        ctx.strokeStyle = '#ff3377';
        ctx.lineWidth = 2;
        ctx.strokeRect(enemy.x, enemy.y, enemy.width, enemy.height);

        // Eyes
        ctx.fillStyle = '#ffff00';
        ctx.fillRect(enemy.x + 5, enemy.y + 6, 6, 6);
        ctx.fillRect(enemy.x + enemy.width - 11, enemy.y + 6, 6, 6);
        ctx.fillStyle = '#000000';
        ctx.fillRect(enemy.x + 7, enemy.y + 8, 2, 2);
        ctx.fillRect(enemy.x + enemy.width - 9, enemy.y + 8, 2, 2);

        ctx.fillStyle = '#ffff00';
        ctx.font = 'bold 10px monospace';
        ctx.fillText('!', enemy.x + enemy.width/2 - 3, enemy.y + enemy.height - 4);
        ctx.shadowBlur = 0;
      });

      // Player
      ctx.shadowBlur = 20;
      ctx.shadowColor = '#00ff00';
      const p = game.player;
      const playerGradient = ctx.createLinearGradient(p.x, p.y, p.x, p.y + p.height);
      playerGradient.addColorStop(0,'#00ff00');
      playerGradient.addColorStop(1,'#00aa00');
      ctx.fillStyle = playerGradient;
      ctx.fillRect(p.x, p.y, p.width, p.height);

      ctx.strokeStyle = '#00ff88';
      ctx.lineWidth = 3;
      ctx.strokeRect(p.x, p.y, p.width, p.height);
      ctx.strokeStyle = '#00ffcc';
      ctx.lineWidth = 1;
      ctx.strokeRect(p.x + 2, p.y + 2, p.width - 4, p.height - 4);

      ctx.fillStyle = '#ffffff';
      ctx.fillRect(p.x + 8, p.y + 8, 4, 4);
      ctx.fillRect(p.x + 18, p.y + 8, 4, 4);
      ctx.fillStyle = '#00ffff';
      ctx.fillRect(p.x + 6, p.y + 20, 18, 3);

      ctx.shadowBlur = 0;

      // Goal with pulse
      const pulse = Math.sin(now / 300) * 0.1 + 0.9;
      const goalSize = { width: game.goal.width * pulse, height: game.goal.height * pulse };
      const goalOffset = { x: (game.goal.width - goalSize.width)/2, y: (game.goal.height - goalSize.height)/2 };

      ctx.shadowBlur = 30;
      ctx.shadowColor = '#ffff00';
      const goalGradient = ctx.createRadialGradient(
        game.goal.x + game.goal.width/2, game.goal.y + game.goal.height/2, 0,
        game.goal.x + game.goal.width/2, game.goal.y + game.goal.height/2, game.goal.width/2
      );
      goalGradient.addColorStop(0,'#ffff00');
      goalGradient.addColorStop(0.5,'#ffcc00');
      goalGradient.addColorStop(1,'#ff9900');
      ctx.fillStyle = goalGradient;
      ctx.fillRect(game.goal.x + goalOffset.x, game.goal.y + goalOffset.y, goalSize.width, goalSize.height);

      ctx.strokeStyle = '#ffff66';
      ctx.lineWidth = 4;
      ctx.strokeRect(game.goal.x + goalOffset.x, game.goal.y + goalOffset.y, goalSize.width, goalSize.height);

      ctx.shadowBlur = 5;
      ctx.fillStyle = '#000000';
      ctx.font = 'bold 18px monospace';
      ctx.fillText('</>', game.goal.x + 8, game.goal.y + 28);

      // Particles
      for (let i=0;i<3;i++){
        const angle = (now/1000 + i * Math.PI*2/3) % (Math.PI*2);
        const radius = 35;
        const px = game.goal.x + game.goal.width/2 + Math.cos(angle) * radius;
        const py = game.goal.y + game.goal.height/2 + Math.sin(angle) * radius;
        ctx.fillStyle = '#ffff00';
        ctx.globalAlpha = 0.6;
        ctx.fillRect(px - 2, py - 2, 4, 4);
        ctx.globalAlpha = 1;
      }

      ctx.shadowBlur = 0;

      // HUD
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#00ff00';
      ctx.fillStyle = '#00ff00';
      ctx.font = 'bold 24px monospace';
      ctx.fillText('FASE ' + level + '/3', 20, 35);

      ctx.shadowBlur = 5;
      ctx.font = '14px monospace';
      ctx.fillStyle = '#00ffaa';
      const levelNames = ['TUTORIAL', 'TORRES VERTICAIS', 'LABIRINTO DIGITAL'];
      ctx.fillText(levelNames[level - 1], 20, 55);

      ctx.shadowBlur = game.hackActive ? 15 : 5;
      ctx.shadowColor = game.canHack ? '#00ffff' : '#666666';
      ctx.fillStyle = game.canHack ? (game.hackActive ? '#00ffff' : '#00aaaa') : '#666666';
      ctx.font = 'bold 18px monospace';
      ctx.fillText('[N] HACK: ' + (game.hackActive ? 'ON' : 'OFF'), 20, 85);

      if (!game.canHack) {
        const cooldownPercent = (game.hackCooldown / 60);
        ctx.fillStyle = '#222222';
        ctx.fillRect(20, 95, 200, 12);
        const barGradient = ctx.createLinearGradient(20,95,220,95);
        barGradient.addColorStop(0,'#ff00ff');
        barGradient.addColorStop(1,'#00ffff');
        ctx.fillStyle = barGradient;
        ctx.fillRect(20,95,200 * (1 - cooldownPercent), 12);
        ctx.strokeStyle = '#00ffff';
        ctx.lineWidth = 2;
        ctx.strokeRect(20,95,200,12);
        ctx.fillStyle = '#ffffff';
        ctx.font = '10px monospace';
        ctx.fillText('RECARREGANDO...', 25, 105);
      }

      // Next frame
      animationId = requestAnimationFrame(gameLoop);
    }

    function showWin() {
      winOverlay.classList.add('show');
    }
    function hideWin() {
      winOverlay.classList.remove('show');
    }

    // restart button
    restartBtn.addEventListener('click', () => {
      level = 1;
      gameState = 'playing';
      initLevel(1);
      hideWin();
    });

    // start
    initLevel(level);
    gameLoop();

    // Expose small helper to allow embedding/resizing if needed
    window.HackerPlace = {
      restart: () => { level = 1; initLevel(1); hideWin(); },
      setLevel: (n) => { level = n; initLevel(level); hideWin(); }
    };
  })();
  </script>
</body>
</html>